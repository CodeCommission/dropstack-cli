#!/usr/bin/env node
const DROPSTACK_BASE_URL = process.env.DROPSTACK_BASE_URL || `https://api.dropstack.run`;

const fs = require('fs');
const path = require('path');
const program = require('commander');
const fetch = require('node-fetch');
const stackSettings = require('../lib/stack-settings')();

program
  .arguments('<name>')
  .action(name => remove(name))
  .parse(process.argv);

function remove(name){
  stackSettings.load()
    .then(settings => fetch(`${DROPSTACK_BASE_URL}/stacks/${name || settings.serviceName}`, { method: 'DELETE', headers: { Authorization: `Bearer ${settings.token}`} }).then(data => data.json()))
    .then(data => console.log(`Stack ${data.serviceName} removed`))
    .then(() => stackSettings.remove())
    .catch(console.error);
}
