#!/usr/bin/env node
const DROPSTACK_BASE_URL = process.env.DROPSTACK_BASE_URL || `https://api.dropstack.run`;

const fs = require('fs');
const path = require('path');
const program = require('commander');
const fetch = require('node-fetch');
const stackSettings = require('../lib/stack-settings')();

program
  .arguments('<id>')
  .action(id => remove(id))
  .parse(process.argv);

function remove(id){
  stackSettings.load({serviceId: id})
    .then(settings => fetch(`${DROPSTACK_BASE_URL}/stacks/${settings.serviceId}`, { method: 'DELETE', headers: { Authorization: `Bearer ${settings.token}`} }).then(data => data.json()))
    .then(data => console.log(`Stack ${data.serviceId} removed`))
    .then(() => stackSettings.save({}))
    .catch(console.error);
}
